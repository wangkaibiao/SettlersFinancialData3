<!DOCTYPE html>
<html>
<head>
    <!-- Load TensorFlow.js -->
    <script src="tfjs@0.13.3"></script>
    <!-- Load Posenet -->
    <script src="posenet@0.2.3"></script>
  <meta charset="utf-8">
  <title>web RTC 测试</title>
  <style>
    .booth {
      width:400px;
      background:#ccc;
      border: 10px solid #ddd;
      margin: 0 auto;
    }
  </style>
</head>


<body>
  <div class="booth">
    <video id="video" width="130" height="130"></video>
    <button id='tack'> snap shot</button>
    <canvas id='canvas' width='130' height='130'></canvas>
    <img id='cat' src='' >
    <!-- <img id='cat' src='' crossorigin="anonymous">  也可以-->
  </div>
  <div class="footer-text">
     <p id="singlePose">结果显示</p>
  </div>
 
  <script>
    var canvas = document.getElementById('canvas'),
        snap = document.getElementById('tack'),
        img = document.getElementById('cat'),
        vendorUrl = window.URL || window.webkitURL;

    // 想要获取一个最接近 1280x720 的相机分辨率
    var constraints = { audio: true, video: { width: 600, height: 500 } };

    navigator.mediaDevices.getUserMedia(constraints).then(function(mediaStream){
        var video = document.querySelector('video');
        video.srcObject = mediaStream;
        video.onloadedmetadata = function(e){
            video.play();
                                             };
                                                                                }
    ).catch(function(err){
        //console.log(err.name + ": " + err.message); }); //总是在最后检查错误
        window.alert(err.name + ": " + err.message);
                         }
            );


    //await 必须伴随async使用
    snap.addEventListener('click', async function(){
        document.getElementById('singlePose').innerHTML="pose";
        canvas.getContext('2d').drawImage(video, 0, 0, 400, 300);//绘制canvas图形        
        img.src = canvas.toDataURL("image/png");                 //把canvas图像转为img图片
 
        const imageScaleFactor = 0.50;
        const flipHorizontal = false;
        const outputStride = 16;
        const imageElement = document.getElementById('cat');
        document.getElementById('singlePose').innerHTML="pose2";

        const net = await posenet.load(0.75);                       // load the posenet model
        document.getElementById('singlePose').innerHTML="pose3";
        try{const pose = await net.estimateSinglePose(imageElement, imageScaleFactor, flipHorizontal, outputStride);}
        catch(e){document.getElementById('singlePose').innerHTML=e.message+":"+e.name;}

        //console.log(pose);
        //window.alert(pose);
        document.getElementById('singlePose').innerHTML="pose4";
        document.getElementById('singlePose').innerHTML= JSON.stringify(pose);
                                                   }
                          )
    <!--  console.log(pose); 的作用是通过【控制台】console显示 结果  -->
  </script>
</body>
</html>
